FLAG = -Wall -Werror -Wextra -g
FLAGS = -st=c11 -g -Wall -Wextra
MACOS = -L /usr/local/lib -lcheck
LINUX = -lcheck -lsubunit -lpthread -lrt -lm -D_GNU_SOURCE
GFLAGS = -coverage -g
OBJECTS = *.o
#ASAN = -g -fsanitize=adress
var = $(shell pkg-config --cflags --libs check)

SOURCES = \
	./secondary_functions/Bit_operations/*.c \
	./secondary_functions/convert_dec/*.c \
	./secondary_functions/float_functions/*.c \
	./secondary_functions/GetSet_SignScale/*.c \
	./secondary_functions/NoSE/*.c \
	./secondary_functions/shifts/*.c \
	./main_functions/Another_functions/*.c \
	./main_functions/Arithmetic_Operators/*.c \
	./main_functions/Comparison_Operators/*.c \
	./extended_decimal/*.c \
	./main_functions/Convertors_and_parsers/*.c 

# SOURCES_WITH_MAIN = \
# 	main.c \
# 	./secondary_functions/Bit_operations/*.c \
# 	./secondary_functions/convert_dec/*.c \
# 	./secondary_functions/dec_to_back_string/*.c \
# 	./secondary_functions/float_functions/*.c \
# 	./secondary_functions/GetSet_SignScale/*.c \
# 	./secondary_functions/NoSE/*.c \
# 	./secondary_functions/Print/*.c \
# 	./secondary_functions/shifts/*.c \
# 	./secondary_functions/tmp/*.c \
# 	./main_functions/Another_functions/*.c \
# 	./main_functions/Arithmetic_Operators/*.c \
# 	./main_functions/Comparison_Operators/*.c \
# 	./extended_decimal/*.c \
# 	./main_functions/Convertors_and_parsers/*.c

all: clean s21_decimal.a 

s21_decimal.a:
	gcc -c $(FLAGS)


s21_test.o: s21_test.c
	$(CC) $(ASAN) $(var) -c s21_test.c

test: s21_decimal.a s21_test.o
	$(CC) $(ASAN) $(GFLAGS) $(LDFLAGS) $(var)  s21_test.o s21_decimal.a -o test $(TFLAGS)
	./test

gcov_report: s21_decimal.a test	
	lcov -t 'gcov_report' -o gcov_report.info -c -d .
	genhtml -o gcov_report gcov_report.info
    

# s21_dec: clean
# 	$(CC) $(CFLAGS) $(SOURCES_WITH_MAIN) $(TFLAGS) -g -o s21_dec
# 	./s21_dec

check:
#    cppcheck --enable=all --suppress=missingIncludeSystem .
	leaks -atExit -exclude -- ./test

clean: 
	rm -rf *.o *.out *.gc
	rm -rf s21_decimal s21_decimal.a s21_dec o_files coverage.* test *dSYM *.css *.html *.gcda *.gcno

rebuild:
	make clean
	make s21_decimal	
	make test

	
